# Test info

- Name: Categories API >> should get categories with flat format
- Location: /home/ramonkey/Developer/fs1-mern/back/tests/api/categories.test.js:46:3

# Error details

```
Error: expect(received).toBe(expected) // Object.is equality

Expected: true
Received: false
    at /home/ramonkey/Developer/fs1-mern/back/tests/api/categories.test.js:51:33
```

# Test source

```ts
   1 | const { test, expect } = require('@playwright/test');
   2 |
   3 | test.describe('Categories API', () => {
   4 |   let authToken;
   5 |
   6 |   // Setup: Create a user for protected routes
   7 |   test.beforeAll(async ({ request }) => {
   8 |     // Register and login as regular user
   9 |     await request.post('/api/auth/register', {
   10 |       data: {
   11 |         username: `categorytest_${Date.now()}`,
   12 |         firstName: 'Categories Test',
   13 |         lastName: 'User',
   14 |         email: `categories_${Date.now()}@example.com`,
   15 |         password: 'TestPassword123!'
   16 |       }
   17 |     });
   18 |
   19 |     const loginResponse = await request.post('/api/auth/login', {
   20 |       data: {
   21 |         email: `categories_${Date.now()}@example.com`,
   22 |         password: 'TestPassword123!'
   23 |       }
   24 |     });
   25 |
   26 |     const loginBody = await loginResponse.json();
   27 |     authToken = loginBody.token;
   28 |   });
   29 |
   30 |   test('should get all categories', async ({ request }) => {
   31 |     const response = await request.get('/api/categories');
   32 |     
   33 |     expect(response.status()).toBe(200);
   34 |     const body = await response.json();
   35 |     expect(Array.isArray(body)).toBe(true);
   36 |   });
   37 |
   38 |   test('should get categories with tree format', async ({ request }) => {
   39 |     const response = await request.get('/api/categories?format=tree');
   40 |     
   41 |     expect(response.status()).toBe(200);
   42 |     const body = await response.json();
   43 |     expect(Array.isArray(body)).toBe(true);
   44 |   });
   45 |
   46 |   test('should get categories with flat format', async ({ request }) => {
   47 |     const response = await request.get('/api/categories?format=flat');
   48 |     
   49 |     expect(response.status()).toBe(200);
   50 |     const body = await response.json();
>  51 |     expect(Array.isArray(body)).toBe(true);
      |                                 ^ Error: expect(received).toBe(expected) // Object.is equality
   52 |   });
   53 |
   54 |   test('should get root categories only', async ({ request }) => {
   55 |     const response = await request.get('/api/categories/roots');
   56 |     
   57 |     expect(response.status()).toBe(200);
   58 |     const body = await response.json();
   59 |     expect(Array.isArray(body)).toBe(true);
   60 |   });
   61 |
   62 |   test('should search categories', async ({ request }) => {
   63 |     const response = await request.get('/api/categories/search?q=guitar');
   64 |     
   65 |     expect(response.status()).toBe(200);
   66 |     const body = await response.json();
   67 |     expect(Array.isArray(body)).toBe(true);
   68 |   });
   69 |
   70 |   test('should require search query parameter', async ({ request }) => {
   71 |     const response = await request.get('/api/categories/search');
   72 |     
   73 |     expect(response.status()).toBe(400);
   74 |   });
   75 |
   76 |   test('should limit search results', async ({ request }) => {
   77 |     const response = await request.get('/api/categories/search?q=guitar&limit=5');
   78 |     
   79 |     expect(response.status()).toBe(200);
   80 |     const body = await response.json();
   81 |     expect(Array.isArray(body)).toBe(true);
   82 |     expect(body.length).toBeLessThanOrEqual(5);
   83 |   });
   84 |
   85 |   test('should get category by slug', async ({ request }) => {
   86 |     // First get all categories to find a valid slug
   87 |     const allCategoriesResponse = await request.get('/api/categories');
   88 |     const categories = await allCategoriesResponse.json();
   89 |     
   90 |     if (categories.length > 0 && categories[0].slug) {
   91 |       const slug = categories[0].slug;
   92 |       const response = await request.get(`/api/categories/slug/${slug}`);
   93 |       
   94 |       expect(response.status()).toBe(200);
   95 |       const body = await response.json();
   96 |       expect(body.slug).toBe(slug);
   97 |     }
   98 |   });
   99 |
  100 |   test('should return 404 for non-existent slug', async ({ request }) => {
  101 |     const response = await request.get('/api/categories/slug/non-existent-slug');
  102 |     
  103 |     expect(response.status()).toBe(404);
  104 |   });
  105 |
  106 |   test('should get categories with maxDepth limit', async ({ request }) => {
  107 |     const response = await request.get('/api/categories?maxDepth=2');
  108 |     
  109 |     expect(response.status()).toBe(200);
  110 |     const body = await response.json();
  111 |     expect(Array.isArray(body)).toBe(true);
  112 |   });
  113 |
  114 |   test('should filter by parentId', async ({ request }) => {
  115 |     // First get all categories to find a valid parent ID
  116 |     const allCategoriesResponse = await request.get('/api/categories');
  117 |     const categories = await allCategoriesResponse.json();
  118 |     
  119 |     if (categories.length > 0) {
  120 |       const parentId = categories[0]._id;
  121 |       const response = await request.get(`/api/categories?parentId=${parentId}`);
  122 |       
  123 |       expect(response.status()).toBe(200);
  124 |       const body = await response.json();
  125 |       expect(Array.isArray(body)).toBe(true);
  126 |     }
  127 |   });
  128 |
  129 |   test('should include inactive categories when requested', async ({ request }) => {
  130 |     const response = await request.get('/api/categories?includeInactive=true');
  131 |     
  132 |     expect(response.status()).toBe(200);
  133 |     const body = await response.json();
  134 |     expect(Array.isArray(body)).toBe(true);
  135 |   });
  136 |
  137 |   test('should require admin authentication to create category', async ({ request }) => {
  138 |     const newCategory = {
  139 |       nombre: 'Test Category',
  140 |       slug: 'test-category',
  141 |       descripcion: 'A test category'
  142 |     };
  143 |
  144 |     const response = await request.post('/api/categories', {
  145 |       data: newCategory
  146 |     });
  147 |
  148 |     expect(response.status()).toBe(401);
  149 |   });
  150 |
  151 |   test('should require admin role to create category', async ({ request }) => {
```